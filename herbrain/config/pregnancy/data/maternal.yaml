defaults:
  - base

registered_meshes: # outputs dict of meshes (key is sessionID)
  _target_: polpo.preprocessing.Pipeline
  steps:
    - _target_: polpo.preprocessing.load.pregnancy.DenseMaternalMeshLoader
      subject_id: null
      as_dict: True
    - _target_: polpo.preprocessing.dict.DictMap
      step:
        _target_: polpo.preprocessing.mesh.io.PvReader
    - _target_: polpo.preprocessing.PartiallyInitializedStep
      Step:
        _target_: polpo.preprocessing.Lambda
        args:
          - target
          - max_iterations
        imports:
          - polpo.preprocessing.mesh.registration.PvAlign
          - polpo.preprocessing.dict.DictMap
        expr: DictMap(PvAlign(target=target, max_iterations=max_iterations))
      _target:
        _target_: polpo.preprocessing.Lambda
        args:
          - meshes
        expr: "meshes[1]" # template mesh
      max_iterations: 500
    - _target_: polpo.preprocessing.dict.DictMap
      step:
        _target_: polpo.preprocessing.mesh.conversion.TrimeshFromPv

reference_image:
  _target_: polpo.preprocessing.Pipeline
  steps:
    - _target_: polpo.preprocessing.load.pregnancy.DenseMaternalSegmentationsLoader
      subset:
        - 1
    - _target_: polpo.preprocessing.ListSqueeze
    - _target_: polpo.preprocessing.mri.MriImageLoader
      return_affine: True
